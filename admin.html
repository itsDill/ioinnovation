<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Matrix Code Rain</title>
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
        background: #111;
        overflow: hidden;
      }
      canvas {
        display: block;
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        pointer-events: none;
      }
      .terminal-controls {
        position: fixed;
        bottom: 24px;
        left: 24px;
        background: rgba(20, 30, 20, 0.95);
        color: #00ff33;
        font-family: monospace;
        border-radius: 8px;
        box-shadow: 0 2px 16px #000a;
        padding: 1rem 1.5rem;
        z-index: 10;
        min-width: 320px;
      }
      .terminal-controls label {
        display: block;
        margin-bottom: 0.5rem;
      }
      .terminal-controls input[type="range"] {
        width: 120px;
        vertical-align: middle;
      }
      .terminal-controls input[type="color"] {
        vertical-align: middle;
        margin-left: 0.5rem;
      }
      .terminal-controls input,
      .terminal-controls select {
        background: #222;
        color: #00ff33;
        border: none;
        border-radius: 4px;
        padding: 2px 6px;
        font-family: inherit;
        margin-left: 0.5rem;
      }
      .terminal-controls button {
        background: #222;
        color: #00ff33;
        border: none;
        border-radius: 4px;
        padding: 4px 12px;
        font-family: inherit;
        margin-top: 0.5rem;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <canvas id="matrix"></canvas>
    <div class="terminal-controls">
      <div style="margin-bottom: 0.5rem">
        Type a command below (e.g. <code>colorchange(blue)</code>,
        <code>speed(50)</code>, <code>fontsize(20)</code>,
        <code>reset()</code>):
      </div>
      <form id="terminalForm" autocomplete="off">
        <input
          type="text"
          id="terminalInput"
          style="
            width: 90%;
            background: #222;
            color: #00ff33;
            border: none;
            padding: 6px;
            font-family: monospace;
          "
          placeholder="Type command..."
          autofocus
        />
        <button type="submit" style="display: none"></button>
      </form>
      <div style="margin-top: 1rem">
        <label>
          Color:
          <input type="color" id="colorPicker" value="#00ff33" />
        </label>
        <label>
          Speed:
          <input type="range" id="speedRange" min="30" max="200" value="90" />
          <span id="speedValue">90</span> ms
        </label>
        <label>
          Font Size:
          <input type="range" id="fontSizeRange" min="10" max="32" value="14" />
          <span id="fontSizeValue">14</span> px
        </label>
        <button id="resetBtn" type="button">Reset</button>
      </div>
      <div
        id="terminalOutput"
        style="margin-top: 0.5rem; font-size: 13px; min-height: 1.5em"
      ></div>
    </div>
    <script>
      // Matrix code rain effect (scarier, slower, smaller)
      const canvas = document.getElementById("matrix");
      const ctx = canvas.getContext("2d");

      let fontSize = 14;
      let speed = 90;
      let color = "#00ff33";
      let intervalId;

      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener("resize", resize);

      const chars =
        "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789{}[]();+-*/=<>!@#$%^&|~".split(
          ""
        );
      let columns = Math.floor(window.innerWidth / fontSize);
      let drops = Array(columns).fill(0);

      function updateColumns() {
        columns = Math.floor(window.innerWidth / fontSize);
        drops = Array(columns).fill(0);
      }

      window.addEventListener("resize", () => {
        updateColumns();
        resize();
      });

      function draw() {
        ctx.fillStyle = "rgba(10, 20, 10, 0.25)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.font = fontSize + "px monospace";
        ctx.fillStyle = color;

        for (let i = 0; i < columns; i++) {
          let text;
          if (Math.random() < 0.01) {
            text = [
              "if (hacked) {",
              "  system.shutdown();",
              "}",
              "console.log('breach detected');",
              "while(true){}",
              "alert('ACCESS DENIED');",
            ][Math.floor(Math.random() * 6)];
          } else {
            text = chars[Math.floor(Math.random() * chars.length)];
          }
          ctx.fillText(text, i * fontSize, drops[i] * fontSize);

          // Move drop down slower
          if (drops[i] * fontSize < canvas.height) {
            drops[i] += Math.random() < 0.7 ? 0.5 : 1;
          } else {
            drops[i] = Math.random() > 0.99 ? 0 : drops[i];
          }
        }
      }

      function startMatrix() {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(draw, speed);
      }

      // Controls
      const colorPicker = document.getElementById("colorPicker");
      const speedRange = document.getElementById("speedRange");
      const speedValue = document.getElementById("speedValue");
      const fontSizeRange = document.getElementById("fontSizeRange");
      const fontSizeValue = document.getElementById("fontSizeValue");
      const resetBtn = document.getElementById("resetBtn");

      colorPicker.addEventListener("input", (e) => {
        color = e.target.value;
      });

      speedRange.addEventListener("input", (e) => {
        speed = Number(e.target.value);
        speedValue.textContent = speed;
        startMatrix();
      });

      fontSizeRange.addEventListener("input", (e) => {
        fontSize = Number(e.target.value);
        fontSizeValue.textContent = fontSize;
        updateColumns();
        resize();
      });

      resetBtn.addEventListener("click", () => {
        color = "#00ff33";
        colorPicker.value = "#00ff33";
        speed = 90;
        speedRange.value = 90;
        speedValue.textContent = 90;
        fontSize = 14;
        fontSizeRange.value = 14;
        fontSizeValue.textContent = 14;
        updateColumns();
        resize();
        startMatrix();
      });

      // Terminal command controls
      const terminalForm = document.getElementById("terminalForm");
      const terminalInput = document.getElementById("terminalInput");
      const terminalOutput = document.getElementById("terminalOutput");

      function showOutput(msg, error = false) {
        terminalOutput.textContent = msg;
        terminalOutput.style.color = error ? "#ff4444" : "#00ff33";
      }

      function parseCommand(cmd) {
        cmd = cmd.trim();
        // colorchange(blue)
        if (/^colorchange\((.+)\)$/i.test(cmd)) {
          let val = cmd.match(/^colorchange\((.+)\)$/i)[1].trim();
          // Accept color names or hex
          let test = document.createElement("div");
          test.style.color = val;
          if (test.style.color) {
            color = val;
            showOutput(`Color changed to ${val}`);
          } else {
            showOutput("Invalid color.", true);
          }
          return;
        }
        // speed(50)
        if (/^speed\((\d+)\)$/i.test(cmd)) {
          let val = parseInt(cmd.match(/^speed\((\d+)\)$/i)[1]);
          if (val >= 30 && val <= 200) {
            speed = val;
            speedRange.value = val;
            speedValue.textContent = val;
            startMatrix();
            showOutput(`Speed set to ${val} ms`);
          } else {
            showOutput("Speed must be 30-200.", true);
          }
          return;
        }
        // fontsize(20)
        if (/^fontsize\((\d+)\)$/i.test(cmd)) {
          let val = parseInt(cmd.match(/^fontsize\((\d+)\)$/i)[1]);
          if (val >= 10 && val <= 32) {
            fontSize = val;
            fontSizeRange.value = val;
            fontSizeValue.textContent = val;
            updateColumns();
            resize();
            showOutput(`Font size set to ${val}px`);
          } else {
            showOutput("Font size must be 10-32.", true);
          }
          return;
        }
        // reset()
        if (/^reset\(\)$/i.test(cmd)) {
          color = "#00ff33";
          speed = 90;
          fontSize = 14;
          colorPicker.value = "#00ff33";
          speedRange.value = 90;
          speedValue.textContent = 90;
          fontSizeRange.value = 14;
          fontSizeValue.textContent = 14;
          updateColumns();
          resize();
          startMatrix();
          showOutput("Settings reset.");
          return;
        }
        showOutput("Unknown command.", true);
      }

      terminalForm.addEventListener("submit", function (e) {
        e.preventDefault();
        const cmd = terminalInput.value;
        if (cmd) parseCommand(cmd);
        terminalInput.value = "";
      });

      startMatrix();
    </script>
  </body>
</html>
